<!DOCTYPE HTML><html><head><title>core.RetrievePowerTrainUp</title><link rel="stylesheet" href="../../../../../Style/Master.css" type="text/css"><script src="../../../../../Scripts/jquery-1.9.1.js" type="text/javascript"></script><script src="../../../../../Scripts/sections.js" type="text/javascript"></script></head><body><div id="wrap"><div id="container"><div id="header"><div id="breadcrumbs"><a href="../../../../../index.html">Project</a> &gt; <a href="../../../../../RaMP/index.html">RaMP</a> &gt; <a href="../../../../../RaMP/User_databases/index.html">User databases</a> &gt; <a href="../../../../../RaMP/User_databases/2.6.1/index.html">2.6.1</a> &gt; Programmability &gt; <a href="../../../../../RaMP/User_databases/2.6.1/Programmability/Stored_Procedures/Stored_Procedures.html">Stored Procedures</a> &gt; core.RetrievePowerTrainUp</div><div id="headerText"></div></div><div id="pageTitle"><img src="../../../../../Images/StoredProcedure32.png" alt="Stored Procedures" title="Stored Procedures" class="StoredProcedure32"> [core].[RetrievePowerTrainUp]</div><div class="panel panel-default panel-collapsible"><div class="panel-heading"><div class="expandCollapse"><img src="../../../../../Images/collapsed.png" alt="collapsed" title="collapsed" class="collapsed" style="display:none;"><img src="../../../../../Images/expanded.png" alt="expanded" title="expanded" class="expanded" style=""></div><a name="properties">Properties</a></div><div class="panel-body"><table cellspacing="1" border="0" class="dataTable table-hover"><tbody><tr><th>Property</th><th>Value</th></tr><tr><td>ANSI Nulls On</td><td><span class="do-yes">True</span></td></tr><tr><td>Quoted Identifier On</td><td><span class="do-yes">True</span></td></tr></tbody></table></div></div><div class="panel panel-default panel-collapsible"><div class="panel-heading"><div class="expandCollapse"><img src="../../../../../Images/collapsed.png" alt="collapsed" title="collapsed" class="collapsed" style="display:none;"><img src="../../../../../Images/expanded.png" alt="expanded" title="expanded" class="expanded" style=""></div><a name="parameters">Parameters</a></div><div class="panel-body"><table cellspacing="1" border="0" class="dataTable table-hover"><tbody><tr><th>Name</th><th>Data Type</th><th>Max Length (Bytes)</th></tr><tr><td>@AssetId</td><td>uniqueidentifier</td><td>16</td></tr></tbody></table></div></div><div class="panel panel-default panel-collapsible"><div class="panel-heading"><div class="expandCollapse"><img src="../../../../../Images/collapsed.png" alt="collapsed" title="collapsed" class="collapsed" style="display:none;"><img src="../../../../../Images/expanded.png" alt="expanded" title="expanded" class="expanded" style=""></div><a name="sqlscript">SQL Script</a></div><div class="panel-body"><div id="sqlScript"><span class="sqlScriptsKeyword">CREATE</span> <span class="sqlScriptsKeyword">PROCEDURE</span> <span class="sqlScriptsNormal">[core]</span><span class="sqlScriptsOperator">.</span><span class="sqlScriptsNormal">[RetrievePowerTrainUp]</span><br> &nbsp;&nbsp;&nbsp;<span class="sqlScriptsNormal">@AssetId</span> <span class="sqlScriptsKeyword">UNIQUEIDENTIFIER</span><br><span class="sqlScriptsKeyword">AS</span><br> &nbsp;&nbsp;&nbsp;<span class="sqlScriptsKeyword">BEGIN</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsKeyword">DECLARE</span> <span class="sqlScriptsNormal">@UpPowerPath</span> <span class="sqlScriptsKeyword">TABLE</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsOperator">(</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsNormal">Id</span> <span class="sqlScriptsKeyword">UNIQUEIDENTIFIER</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsNormal">,</span> <span class="sqlScriptsNormal">AssetId</span> <span class="sqlScriptsKeyword">UNIQUEIDENTIFIER</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsNormal">,</span> <span class="sqlScriptsNormal">UpstreamAssetId</span> <span class="sqlScriptsKeyword">UNIQUEIDENTIFIER</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsNormal">,</span> <span class="sqlScriptsNormal">NumberOfPowerParentsForAssetId</span> <span class="sqlScriptsKeyword">INT</span> <br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsNormal">,</span> <span class="sqlScriptsNormal">NumberOfPowerParentForUpstreamAssetId</span> <span class="sqlScriptsKeyword">INT</span> <br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsNormal">,</span> <span class="sqlScriptsNormal">NumberOfPowerChildrenForUpstreamAssetIdInThisTrain</span> <span class="sqlScriptsKeyword">INT</span> <span class="sqlScriptsOperator">NULL</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsNormal">,</span> <span class="sqlScriptsNormal">UpstreamIsPointOfFailure</span> <span class="sqlScriptsKeyword">BIT</span> <span class="sqlScriptsKeyword">DEFAULT</span> <span class="sqlScriptsNormal">0</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsOperator">)</span> <span class="sqlScriptsNormal">;</span><br><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsKeyword">WITH</span> <span class="sqlScriptsNormal">UpstreamPower_CTE</span> <span class="sqlScriptsOperator">(</span><span class="sqlScriptsNormal">Id</span><span class="sqlScriptsNormal">,</span> <span class="sqlScriptsNormal">AssetId</span><span class="sqlScriptsNormal">,</span> <span class="sqlScriptsNormal">UpstreamAssetId</span><span class="sqlScriptsOperator">)</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsKeyword">AS</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsOperator">(</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsKeyword">SELECT</span> <span class="sqlScriptsNormal">Id</span><span class="sqlScriptsNormal">,</span> <span class="sqlScriptsNormal">AssetId</span><span class="sqlScriptsNormal">,</span> <span class="sqlScriptsNormal">UpstreamAssetId</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsKeyword">FROM</span> <span class="sqlScriptsNormal">core.UpstreamPower</span> <span class="sqlScriptsKeyword">AS</span> <span class="sqlScriptsNormal">UP</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsKeyword">WHERE</span> <span class="sqlScriptsNormal">AssetId</span> <span class="sqlScriptsOperator">=</span> <span class="sqlScriptsNormal">@AssetId</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsKeyword">UNION</span> <span class="sqlScriptsOperator">ALL</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsKeyword">SELECT</span> <span class="sqlScriptsNormal">UP2.Id</span><span class="sqlScriptsNormal">,</span> <span class="sqlScriptsNormal">UP2.AssetId</span><span class="sqlScriptsNormal">,</span> <span class="sqlScriptsNormal">UP2.UpstreamAssetId</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsKeyword">FROM</span> <span class="sqlScriptsNormal">core.UpstreamPower</span> <span class="sqlScriptsKeyword">AS</span> <span class="sqlScriptsNormal">UP2</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsOperator">INNER</span> <span class="sqlScriptsOperator">JOIN</span> <span class="sqlScriptsNormal">UpstreamPower_CTE</span> <span class="sqlScriptsKeyword">AS</span> <span class="sqlScriptsNormal">UPCTE</span> <span class="sqlScriptsKeyword">ON</span> <span class="sqlScriptsNormal">UPCTE.UpstreamAssetId</span> <span class="sqlScriptsOperator">=</span> <span class="sqlScriptsNormal">UP2.AssetId</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsOperator">)</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsKeyword">INSERT</span> <span class="sqlScriptsKeyword">INTO</span> <span class="sqlScriptsNormal">@UpPowerPath</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsOperator">(</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsNormal">Id</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsNormal">,</span><span class="sqlScriptsNormal">AssetId</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsNormal">,</span><span class="sqlScriptsNormal">UpstreamAssetId</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsNormal">,</span><span class="sqlScriptsNormal">NumberOfPowerParentsForAssetId</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsNormal">,</span><span class="sqlScriptsNormal">NumberOfPowerParentForUpstreamAssetId</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsOperator">)</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsKeyword">SELECT</span> <span class="sqlScriptsKeyword">DISTINCT</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsNormal">UPCTE.Id</span><span class="sqlScriptsNormal">,</span> <span class="sqlScriptsNormal">UPCTE.AssetId</span> <span class="sqlScriptsNormal">,</span><span class="sqlScriptsNormal">UPCTE.UpstreamAssetId</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsNormal">,</span> <span class="sqlScriptsOperator">(</span><span class="sqlScriptsKeyword">SELECT</span> <span class="sqlScriptsFunction">COUNT</span><span class="sqlScriptsOperator">(</span><span class="sqlScriptsNormal">1</span><span class="sqlScriptsOperator">)</span> <span class="sqlScriptsKeyword">FROM</span> <span class="sqlScriptsNormal">core.UpstreamPower</span> <span class="sqlScriptsKeyword">AS</span> <span class="sqlScriptsNormal">UP</span> <span class="sqlScriptsKeyword">WHERE</span> <span class="sqlScriptsNormal">UP.AssetId</span> <span class="sqlScriptsOperator">=</span> <span class="sqlScriptsNormal">UPCTE.AssetId</span><span class="sqlScriptsOperator">)</span> <span class="sqlScriptsKeyword">AS</span> <span class="sqlScriptsString">&#39;NumberOfPowerParentsForAssetId&#39;</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsNormal">,</span> <span class="sqlScriptsOperator">(</span><span class="sqlScriptsKeyword">SELECT</span> <span class="sqlScriptsFunction">COUNT</span><span class="sqlScriptsOperator">(</span><span class="sqlScriptsNormal">1</span><span class="sqlScriptsOperator">)</span> <span class="sqlScriptsKeyword">FROM</span> <span class="sqlScriptsNormal">core.UpstreamPower</span> <span class="sqlScriptsKeyword">AS</span> <span class="sqlScriptsNormal">UP</span> <span class="sqlScriptsKeyword">WHERE</span> <span class="sqlScriptsNormal">UP.AssetId</span> <span class="sqlScriptsOperator">=</span> <span class="sqlScriptsNormal">UPCTE.UpstreamAssetId</span><span class="sqlScriptsOperator">)</span> <span class="sqlScriptsKeyword">AS</span> <span class="sqlScriptsString">&#39;NumberOfPowerParentForUpstreamAssetId&#39;</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsKeyword">FROM</span> <span class="sqlScriptsNormal">UpstreamPower_CTE</span> <span class="sqlScriptsKeyword">AS</span> <span class="sqlScriptsNormal">UPCTE</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsKeyword">UPDATE</span> <span class="sqlScriptsNormal">@UpPowerPath</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsKeyword">SET</span> <br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsNormal">NumberOfPowerChildrenForUpstreamAssetIdInThisTrain</span> <span class="sqlScriptsOperator">=</span> <span class="sqlScriptsOperator">(</span><span class="sqlScriptsKeyword">SELECT</span> <span class="sqlScriptsFunction">COUNT</span><span class="sqlScriptsOperator">(</span><span class="sqlScriptsNormal">1</span><span class="sqlScriptsOperator">)</span> <span class="sqlScriptsKeyword">FROM</span> <span class="sqlScriptsNormal">@UpPowerPath</span> <span class="sqlScriptsKeyword">AS</span> <span class="sqlScriptsNormal">UPP2</span> <span class="sqlScriptsKeyword">WHERE</span> <span class="sqlScriptsNormal">UPP2.UpstreamAssetId</span> <span class="sqlScriptsOperator">=</span> <span class="sqlScriptsNormal">UPP.UpstreamAssetId</span><span class="sqlScriptsOperator">)</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsKeyword">FROM</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsNormal">@UpPowerPath</span> <span class="sqlScriptsKeyword">AS</span> <span class="sqlScriptsNormal">UPP</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsKeyword">DECLARE</span> <span class="sqlScriptsNormal">@LeafAssetIds</span> <span class="sqlScriptsKeyword">TABLE</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsOperator">(</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsNormal">AssetId</span> <span class="sqlScriptsKeyword">UNIQUEIDENTIFIER</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsOperator">)</span> <span class="sqlScriptsNormal">;</span><br><br><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsKeyword">INSERT</span> <span class="sqlScriptsKeyword">INTO</span> <span class="sqlScriptsNormal">@LeafAssetIds</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsOperator">(</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsNormal">AssetId</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsOperator">)</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsKeyword">SELECT</span> <span class="sqlScriptsKeyword">DISTINCT</span> <span class="sqlScriptsNormal">UPP.UpstreamAssetId</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsKeyword">FROM</span> <span class="sqlScriptsNormal">@UpPowerPath</span> <span class="sqlScriptsKeyword">AS</span> <span class="sqlScriptsNormal">UPP</span> &nbsp;&nbsp;&nbsp;<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsKeyword">WHERE</span> <span class="sqlScriptsNormal">NumberOfPowerParentForUpstreamAssetId</span> <span class="sqlScriptsOperator">=</span> <span class="sqlScriptsNormal">0</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsKeyword">IF</span> <span class="sqlScriptsOperator">(</span><span class="sqlScriptsKeyword">SELECT</span> <span class="sqlScriptsFunction">COUNT</span> <span class="sqlScriptsOperator">(</span><span class="sqlScriptsNormal">1</span><span class="sqlScriptsOperator">)</span> <span class="sqlScriptsKeyword">FROM</span> <span class="sqlScriptsNormal">@LeafAssetIds</span><span class="sqlScriptsOperator">)</span> <span class="sqlScriptsOperator">=</span> <span class="sqlScriptsNormal">1</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsKeyword">BEGIN</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsComment">--If there is a single point of failure for the given @AssetId then there will be only 1 leaf in the up stream power source tree.</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsComment">-- &nbsp;&nbsp;&nbsp;We then have to walk the tree from the leaf and figure out anything else in its path back to the root (the given asset) is also a single point a failure</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsKeyword">DECLARE</span> <span class="sqlScriptsNormal">@LeafAssetId</span> <span class="sqlScriptsKeyword">UNIQUEIDENTIFIER</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsKeyword">SELECT</span> <span class="sqlScriptsNormal">@LeafAssetId</span> <span class="sqlScriptsOperator">=</span> <span class="sqlScriptsNormal">AssetId</span> <span class="sqlScriptsKeyword">FROM</span> <span class="sqlScriptsNormal">@LeafAssetIds</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsKeyword">DECLARE</span> <span class="sqlScriptsNormal">@FailurePointsTable</span> <span class="sqlScriptsKeyword">TABLE</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsOperator">(</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsNormal">AssetId</span> <span class="sqlScriptsKeyword">UNIQUEIDENTIFIER</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsNormal">,</span><span class="sqlScriptsNormal">UpstreamAssetId</span> <span class="sqlScriptsKeyword">UNIQUEIDENTIFIER</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsOperator">)</span> <span class="sqlScriptsNormal">;</span><br><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsKeyword">WITH</span> <span class="sqlScriptsNormal">FailurePoints_CTE</span> <span class="sqlScriptsOperator">(</span><span class="sqlScriptsNormal">Id</span><span class="sqlScriptsNormal">,</span> <span class="sqlScriptsNormal">AssetId</span><span class="sqlScriptsNormal">,</span> <span class="sqlScriptsNormal">UpstreamAssetId</span><span class="sqlScriptsOperator">)</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsKeyword">AS</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsOperator">(</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsKeyword">SELECT</span> <span class="sqlScriptsNormal">Id</span><span class="sqlScriptsNormal">,</span> <span class="sqlScriptsNormal">AssetId</span><span class="sqlScriptsNormal">,</span> <span class="sqlScriptsNormal">UpstreamAssetId</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsKeyword">FROM</span> <span class="sqlScriptsNormal">@UpPowerPath</span> <span class="sqlScriptsKeyword">AS</span> <span class="sqlScriptsNormal">UP</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsKeyword">WHERE</span> <span class="sqlScriptsNormal">UpstreamAssetId</span> <span class="sqlScriptsOperator">=</span> <span class="sqlScriptsNormal">@LeafAssetId</span> <span class="sqlScriptsOperator">AND</span> <span class="sqlScriptsNormal">NumberOfPowerChildrenForUpstreamAssetIdInThisTrain</span> <span class="sqlScriptsOperator">=</span> <span class="sqlScriptsNormal">1</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsKeyword">UNION</span> <span class="sqlScriptsOperator">ALL</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsKeyword">SELECT</span> <span class="sqlScriptsNormal">UP2.Id</span><span class="sqlScriptsNormal">,</span> <span class="sqlScriptsNormal">UP2.AssetId</span><span class="sqlScriptsNormal">,</span> <span class="sqlScriptsNormal">UP2.UpstreamAssetId</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsKeyword">FROM</span> <span class="sqlScriptsNormal">@UpPowerPath</span> <span class="sqlScriptsKeyword">AS</span> <span class="sqlScriptsNormal">UP2</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsOperator">INNER</span> <span class="sqlScriptsOperator">JOIN</span> <span class="sqlScriptsNormal">FailurePoints_CTE</span> <span class="sqlScriptsKeyword">AS</span> <span class="sqlScriptsNormal">FPCTE</span> <span class="sqlScriptsKeyword">ON</span> <span class="sqlScriptsNormal">FPCTE.AssetId</span> <span class="sqlScriptsOperator">=</span> <span class="sqlScriptsNormal">UP2.UpstreamAssetId</span> <span class="sqlScriptsOperator">AND</span> <span class="sqlScriptsNormal">NumberOfPowerChildrenForUpstreamAssetIdInThisTrain</span> <span class="sqlScriptsOperator">=</span> <span class="sqlScriptsNormal">1</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsOperator">)</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsKeyword">INSERT</span> <span class="sqlScriptsKeyword">INTO</span> <span class="sqlScriptsNormal">@FailurePointsTable</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsOperator">(</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsNormal">AssetId</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsNormal">,</span><span class="sqlScriptsNormal">UpstreamAssetId</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsOperator">)</span> &nbsp;&nbsp;&nbsp;<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsKeyword">SELECT</span> <br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsNormal">FPCTE.AssetId</span> <span class="sqlScriptsNormal">,</span><span class="sqlScriptsNormal">FPCTE.UpstreamAssetId</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsKeyword">FROM</span> <span class="sqlScriptsNormal">FailurePoints_CTE</span> <span class="sqlScriptsKeyword">AS</span> <span class="sqlScriptsNormal">FPCTE</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsComment">--Currently in the @FailurePointsTable are nearly all the points of failure. &nbsp;We just need to add one (the union below) to take into account when more than one thing in the power train has the same power parent and that power parent is not the leaf.</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsKeyword">UPDATE</span> &nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsNormal">@UpPowerPath</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsKeyword">SET</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsNormal">UpstreamIsPointOfFailure</span> <span class="sqlScriptsOperator">=</span> <span class="sqlScriptsNormal">1</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsKeyword">FROM</span> <br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsNormal">@UpPowerPath</span> <span class="sqlScriptsKeyword">AS</span> <span class="sqlScriptsNormal">UPP</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsKeyword">WHERE</span> <br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsNormal">UPP.UpstreamAssetId</span> <span class="sqlScriptsOperator">IN</span> <br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsOperator">(</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsKeyword">SELECT</span> <span class="sqlScriptsNormal">UpstreamAssetId</span> <span class="sqlScriptsKeyword">from</span> <span class="sqlScriptsNormal">@FailurePointsTable</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsKeyword">UNION</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsKeyword">SELECT</span> <span class="sqlScriptsNormal">AssetId</span> <span class="sqlScriptsKeyword">from</span> <span class="sqlScriptsNormal">@FailurePointsTable</span> <span class="sqlScriptsKeyword">WHERE</span> <span class="sqlScriptsNormal">AssetId</span> <span class="sqlScriptsNormal">&lt;&gt;</span> <span class="sqlScriptsNormal">@AssetId</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsKeyword">UNION</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsKeyword">SELECT</span> <span class="sqlScriptsNormal">@LeafAssetId</span> <br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsOperator">)</span> <span class="sqlScriptsNormal">;</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsKeyword">END</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsKeyword">SELECT</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsNormal">UPP.Id</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsNormal">,</span><span class="sqlScriptsNormal">UPP.AssetId</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsNormal">,</span><span class="sqlScriptsNormal">UPP.UpstreamAssetId</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsNormal">,</span><span class="sqlScriptsNormal">UPP.UpstreamIsPointOfFailure</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsNormal">,</span><span class="sqlScriptsNormal">A2.Name</span> <span class="sqlScriptsKeyword">AS</span> <span class="sqlScriptsString">&#39;UpstreamName&#39;</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsNormal">,</span><span class="sqlScriptsNormal">A2.ShortName</span> <span class="sqlScriptsKeyword">AS</span> <span class="sqlScriptsString">&#39;UpstreamShortName&#39;</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsNormal">,</span><span class="sqlScriptsNormal">A2.OverrideName</span> <span class="sqlScriptsKeyword">AS</span> <span class="sqlScriptsString">&#39;UpstreamOverrideName&#39;</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsNormal">,</span><span class="sqlScriptsNormal">A2.</span><span class="sqlScriptsNormal">[Type]</span> <span class="sqlScriptsKeyword">AS</span> <span class="sqlScriptsString">&#39;UpstreamType&#39;</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsNormal">,(</span><span class="sqlScriptsKeyword">SELECT</span> <span class="sqlScriptsKeyword">TOP</span> <span class="sqlScriptsNormal">1</span> <span class="sqlScriptsNormal">S.SensorId</span> <span class="sqlScriptsKeyword">FROM</span> <span class="sqlScriptsNormal">core.Sensor</span> <span class="sqlScriptsKeyword">AS</span> <span class="sqlScriptsNormal">S</span> <span class="sqlScriptsKeyword">WHERE</span> <span class="sqlScriptsNormal">S.DeviceId</span> <span class="sqlScriptsOperator">=</span> <span class="sqlScriptsNormal">UPP.UpstreamAssetId</span> <span class="sqlScriptsOperator">AND</span> <span class="sqlScriptsNormal">S.</span><span class="sqlScriptsNormal">[Type]</span> <span class="sqlScriptsOperator">IN</span> <span class="sqlScriptsNormal">(</span><span class="sqlScriptsString">&#39;power&#39;</span><span class="sqlScriptsNormal">,</span> <span class="sqlScriptsString">&#39;totalPower&#39;</span><span class="sqlScriptsNormal">,</span> <span class="sqlScriptsString">&#39;outputTotalPower&#39;</span><span class="sqlScriptsOperator">)</span> <span class="sqlScriptsKeyword">ORDER</span> <span class="sqlScriptsKeyword">BY</span> <span class="sqlScriptsKeyword">CASE</span> <span class="sqlScriptsNormal">S.</span><span class="sqlScriptsNormal">[Type]</span> <span class="sqlScriptsKeyword">WHEN</span> &nbsp;<span class="sqlScriptsString">&#39;outputTotalPower&#39;</span> <span class="sqlScriptsKeyword">THEN</span> <span class="sqlScriptsNormal">1</span> <span class="sqlScriptsKeyword">WHEN</span> <span class="sqlScriptsString">&#39;totalPower&#39;</span> <span class="sqlScriptsKeyword">THEN</span> <span class="sqlScriptsNormal">2</span> <span class="sqlScriptsKeyword">WHEN</span> <span class="sqlScriptsString">&#39;power&#39;</span> <span class="sqlScriptsKeyword">THEN</span> <span class="sqlScriptsNormal">3</span> <span class="sqlScriptsKeyword">ELSE</span> <span class="sqlScriptsNormal">4</span> <span class="sqlScriptsKeyword">END</span><span class="sqlScriptsOperator">)</span> <span class="sqlScriptsKeyword">AS</span> <span class="sqlScriptsString">&#39;TotalPowerSensorId&#39;</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsNormal">,(</span><span class="sqlScriptsKeyword">SELECT</span> <span class="sqlScriptsKeyword">TOP</span> <span class="sqlScriptsNormal">1</span> <span class="sqlScriptsNormal">S.OriginType</span> <span class="sqlScriptsKeyword">FROM</span> <span class="sqlScriptsNormal">core.Sensor</span> <span class="sqlScriptsKeyword">AS</span> <span class="sqlScriptsNormal">S</span> <span class="sqlScriptsKeyword">WHERE</span> <span class="sqlScriptsNormal">S.DeviceId</span> <span class="sqlScriptsOperator">=</span> <span class="sqlScriptsNormal">UPP.UpstreamAssetId</span> <span class="sqlScriptsOperator">AND</span> <span class="sqlScriptsNormal">S.</span><span class="sqlScriptsNormal">[Type]</span> <span class="sqlScriptsOperator">IN</span> <span class="sqlScriptsNormal">(</span><span class="sqlScriptsString">&#39;power&#39;</span><span class="sqlScriptsNormal">,</span> <span class="sqlScriptsString">&#39;totalPower&#39;</span><span class="sqlScriptsNormal">,</span> <span class="sqlScriptsString">&#39;outputTotalPower&#39;</span><span class="sqlScriptsOperator">)</span> <span class="sqlScriptsKeyword">ORDER</span> <span class="sqlScriptsKeyword">BY</span> <span class="sqlScriptsKeyword">CASE</span> <span class="sqlScriptsNormal">S.</span><span class="sqlScriptsNormal">[Type]</span> <span class="sqlScriptsKeyword">WHEN</span> &nbsp;<span class="sqlScriptsString">&#39;outputTotalPower&#39;</span> <span class="sqlScriptsKeyword">THEN</span> <span class="sqlScriptsNormal">1</span> <span class="sqlScriptsKeyword">WHEN</span> <span class="sqlScriptsString">&#39;totalPower&#39;</span> <span class="sqlScriptsKeyword">THEN</span> <span class="sqlScriptsNormal">2</span> <span class="sqlScriptsKeyword">WHEN</span> <span class="sqlScriptsString">&#39;power&#39;</span> <span class="sqlScriptsKeyword">THEN</span> <span class="sqlScriptsNormal">3</span> <span class="sqlScriptsKeyword">ELSE</span> <span class="sqlScriptsNormal">4</span> <span class="sqlScriptsKeyword">END</span><span class="sqlScriptsOperator">)</span> <span class="sqlScriptsKeyword">AS</span> <span class="sqlScriptsString">&#39;TotalPowerOriginType&#39;</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsNormal">,(</span><span class="sqlScriptsKeyword">SELECT</span> <span class="sqlScriptsKeyword">TOP</span> <span class="sqlScriptsNormal">1</span> <span class="sqlScriptsNormal">S.SensorId</span> <span class="sqlScriptsKeyword">FROM</span> <span class="sqlScriptsNormal">core.Sensor</span> <span class="sqlScriptsKeyword">AS</span> <span class="sqlScriptsNormal">S</span> <span class="sqlScriptsKeyword">WHERE</span> <span class="sqlScriptsNormal">S.DeviceId</span> <span class="sqlScriptsOperator">=</span> <span class="sqlScriptsNormal">UPP.UpstreamAssetId</span> <span class="sqlScriptsOperator">AND</span> <span class="sqlScriptsNormal">S.</span><span class="sqlScriptsNormal">[Type]</span> <span class="sqlScriptsOperator">IN</span> <span class="sqlScriptsNormal">(</span><span class="sqlScriptsString">&#39;totalLoad&#39;</span><span class="sqlScriptsNormal">,</span> <span class="sqlScriptsString">&#39;outputTotalLoad&#39;</span><span class="sqlScriptsOperator">)</span> <span class="sqlScriptsKeyword">ORDER</span> <span class="sqlScriptsKeyword">BY</span> <span class="sqlScriptsKeyword">CASE</span> <span class="sqlScriptsNormal">S.</span><span class="sqlScriptsNormal">[Type]</span> <span class="sqlScriptsKeyword">WHEN</span> &nbsp;<span class="sqlScriptsString">&#39;outputTotalLoad&#39;</span> <span class="sqlScriptsKeyword">THEN</span> <span class="sqlScriptsNormal">1</span> <span class="sqlScriptsKeyword">WHEN</span> <span class="sqlScriptsString">&#39;totalLoad&#39;</span> <span class="sqlScriptsKeyword">THEN</span> <span class="sqlScriptsNormal">2</span> <span class="sqlScriptsKeyword">ELSE</span> <span class="sqlScriptsNormal">3</span> <span class="sqlScriptsKeyword">END</span><span class="sqlScriptsOperator">)</span> <span class="sqlScriptsKeyword">AS</span> <span class="sqlScriptsString">&#39;TotalLoadSensorId&#39;</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsNormal">,(</span><span class="sqlScriptsKeyword">SELECT</span> <span class="sqlScriptsKeyword">TOP</span> <span class="sqlScriptsNormal">1</span> <span class="sqlScriptsNormal">S.OriginType</span> <span class="sqlScriptsKeyword">FROM</span> <span class="sqlScriptsNormal">core.Sensor</span> <span class="sqlScriptsKeyword">AS</span> <span class="sqlScriptsNormal">S</span> <span class="sqlScriptsKeyword">WHERE</span> <span class="sqlScriptsNormal">S.DeviceId</span> <span class="sqlScriptsOperator">=</span> <span class="sqlScriptsNormal">UPP.UpstreamAssetId</span> <span class="sqlScriptsOperator">AND</span> <span class="sqlScriptsNormal">S.</span><span class="sqlScriptsNormal">[Type]</span> <span class="sqlScriptsOperator">IN</span> <span class="sqlScriptsNormal">(</span><span class="sqlScriptsString">&#39;totalLoad&#39;</span><span class="sqlScriptsNormal">,</span> <span class="sqlScriptsString">&#39;outputTotalLoad&#39;</span><span class="sqlScriptsOperator">)</span> <span class="sqlScriptsKeyword">ORDER</span> <span class="sqlScriptsKeyword">BY</span> <span class="sqlScriptsKeyword">CASE</span> <span class="sqlScriptsNormal">S.</span><span class="sqlScriptsNormal">[Type]</span> <span class="sqlScriptsKeyword">WHEN</span> &nbsp;<span class="sqlScriptsString">&#39;outputTotalLoad&#39;</span> <span class="sqlScriptsKeyword">THEN</span> <span class="sqlScriptsNormal">1</span> <span class="sqlScriptsKeyword">WHEN</span> <span class="sqlScriptsString">&#39;totalLoad&#39;</span> <span class="sqlScriptsKeyword">THEN</span> <span class="sqlScriptsNormal">2</span> <span class="sqlScriptsKeyword">ELSE</span> <span class="sqlScriptsNormal">3</span> <span class="sqlScriptsKeyword">END</span><span class="sqlScriptsOperator">)</span> <span class="sqlScriptsKeyword">AS</span> <span class="sqlScriptsString">&#39;TotalLoadOriginType&#39;</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsKeyword">FROM</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsNormal">@UpPowerPath</span> <span class="sqlScriptsKeyword">AS</span> <span class="sqlScriptsNormal">UPP</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsOperator">INNER</span> <span class="sqlScriptsOperator">JOIN</span> <span class="sqlScriptsNormal">core.Asset</span> <span class="sqlScriptsKeyword">AS</span> <span class="sqlScriptsNormal">A2</span> <span class="sqlScriptsKeyword">ON</span> <span class="sqlScriptsNormal">UPP.UpstreamAssetId</span> <span class="sqlScriptsOperator">=</span> <span class="sqlScriptsNormal">A2.AssetId</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br> &nbsp;&nbsp;&nbsp;<span class="sqlScriptsKeyword">END</span><br><span class="sqlScriptsNormal">GO</span><br></div></div></div><div class="panel panel-default panel-collapsible"><div class="panel-heading"><div class="expandCollapse"><img src="../../../../../Images/collapsed.png" alt="collapsed" title="collapsed" class="collapsed" style="display:none;"><img src="../../../../../Images/expanded.png" alt="expanded" title="expanded" class="expanded" style=""></div><a name="uses">Uses</a></div><div class="panel-body"><ul class="DependencyList"><li><a href="../../../../../RaMP/User_databases/2.6.1/Tables/Asset.html">[core].[Asset]</a></li> <li><a href="../../../../../RaMP/User_databases/2.6.1/Tables/Sensor.html">[core].[Sensor]</a></li> <li><a href="../../../../../RaMP/User_databases/2.6.1/Tables/UpstreamPower.html">[core].[UpstreamPower]</a></li> <li>[core]</li> </ul></div></div></div></div><div id="footer"><div class="row"><div id="customtext" class="col-sm-4"><div id="projectauthor">Author: &nbsp;No Limits Software</div></div><div id="copyright" class="col-sm-4">Copyright 2014 - All Rights Reserved</div><div id="date" class="col-sm-4">Created: 07 February 2014</div></div></div></body></html>