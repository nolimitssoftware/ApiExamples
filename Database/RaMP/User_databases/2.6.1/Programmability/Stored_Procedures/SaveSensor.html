<!DOCTYPE HTML><html><head><title>core.SaveSensor</title><link rel="stylesheet" href="../../../../../Style/Master.css" type="text/css"><script src="../../../../../Scripts/jquery-1.9.1.js" type="text/javascript"></script><script src="../../../../../Scripts/sections.js" type="text/javascript"></script></head><body><div id="wrap"><div id="container"><div id="header"><div id="breadcrumbs"><a href="../../../../../index.html">Project</a> &gt; <a href="../../../../../RaMP/index.html">RaMP</a> &gt; <a href="../../../../../RaMP/User_databases/index.html">User databases</a> &gt; <a href="../../../../../RaMP/User_databases/2.6.1/index.html">2.6.1</a> &gt; Programmability &gt; <a href="../../../../../RaMP/User_databases/2.6.1/Programmability/Stored_Procedures/Stored_Procedures.html">Stored Procedures</a> &gt; core.SaveSensor</div><div id="headerText"></div></div><div id="pageTitle"><img src="../../../../../Images/StoredProcedure32.png" alt="Stored Procedures" title="Stored Procedures" class="StoredProcedure32"> [core].[SaveSensor]</div><div class="panel panel-default panel-collapsible"><div class="panel-heading"><div class="expandCollapse"><img src="../../../../../Images/collapsed.png" alt="collapsed" title="collapsed" class="collapsed" style="display:none;"><img src="../../../../../Images/expanded.png" alt="expanded" title="expanded" class="expanded" style=""></div><a name="properties">Properties</a></div><div class="panel-body"><table cellspacing="1" border="0" class="dataTable table-hover"><tbody><tr><th>Property</th><th>Value</th></tr><tr><td>ANSI Nulls On</td><td><span class="do-yes">True</span></td></tr><tr><td>Quoted Identifier On</td><td><span class="do-yes">True</span></td></tr></tbody></table></div></div><div class="panel panel-default panel-collapsible"><div class="panel-heading"><div class="expandCollapse"><img src="../../../../../Images/collapsed.png" alt="collapsed" title="collapsed" class="collapsed" style="display:none;"><img src="../../../../../Images/expanded.png" alt="expanded" title="expanded" class="expanded" style=""></div><a name="parameters">Parameters</a></div><div class="panel-body"><table cellspacing="1" border="0" class="dataTable table-hover"><tbody><tr><th>Name</th><th>Data Type</th><th>Max Length (Bytes)</th></tr><tr><td>@SensorId</td><td>uniqueidentifier</td><td>16</td></tr><tr><td>@UserName</td><td>varchar(128)</td><td>128</td></tr><tr><td>@LocationAssetId</td><td>uniqueidentifier</td><td>16</td></tr><tr><td>@RackLocation</td><td>tinyint</td><td>1</td></tr><tr><td>@Position</td><td>int</td><td>4</td></tr></tbody></table></div></div><div class="panel panel-default panel-collapsible"><div class="panel-heading"><div class="expandCollapse"><img src="../../../../../Images/collapsed.png" alt="collapsed" title="collapsed" class="collapsed" style="display:none;"><img src="../../../../../Images/expanded.png" alt="expanded" title="expanded" class="expanded" style=""></div><a name="sqlscript">SQL Script</a></div><div class="panel-body"><div id="sqlScript"><span class="sqlScriptsKeyword">CREATE</span> <span class="sqlScriptsKeyword">PROCEDURE</span> <span class="sqlScriptsNormal">[core]</span><span class="sqlScriptsOperator">.</span><span class="sqlScriptsNormal">[SaveSensor]</span><br> &nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsNormal">@SensorId</span> <span class="sqlScriptsKeyword">UNIQUEIDENTIFIER</span> <span class="sqlScriptsNormal">,</span><br> &nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsNormal">@UserName</span> <span class="sqlScriptsKeyword">VARCHAR</span><span class="sqlScriptsOperator">(</span><span class="sqlScriptsNormal">128</span><span class="sqlScriptsOperator">)</span> <span class="sqlScriptsOperator">=</span> <span class="sqlScriptsOperator">NULL</span><span class="sqlScriptsNormal">,</span><br> &nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsNormal">@LocationAssetId</span> <span class="sqlScriptsKeyword">UNIQUEIDENTIFIER</span> <span class="sqlScriptsOperator">=</span> <span class="sqlScriptsOperator">NULL</span><span class="sqlScriptsNormal">,</span><br> &nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsNormal">@RackLocation</span> <span class="sqlScriptsKeyword">TINYINT</span> <span class="sqlScriptsOperator">=</span> <span class="sqlScriptsOperator">NULL</span><span class="sqlScriptsNormal">,</span><br> &nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsNormal">@Position</span> <span class="sqlScriptsKeyword">INT</span> <span class="sqlScriptsOperator">=</span> <span class="sqlScriptsOperator">NULL</span><br><span class="sqlScriptsKeyword">AS</span> <br> &nbsp;&nbsp;&nbsp;<span class="sqlScriptsKeyword">BEGIN</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsKeyword">IF</span> <span class="sqlScriptsOperator">(</span><span class="sqlScriptsNormal">@LocationAssetId</span> <span class="sqlScriptsOperator">IS</span> <span class="sqlScriptsOperator">NULL</span><span class="sqlScriptsOperator">)</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsKeyword">BEGIN</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsKeyword">SELECT</span> <span class="sqlScriptsNormal">@LocationAssetId</span> <span class="sqlScriptsOperator">=</span> <span class="sqlScriptsNormal">DeviceId</span> <span class="sqlScriptsKeyword">FROM</span> <span class="sqlScriptsNormal">[core]</span><span class="sqlScriptsNormal">.Sensor</span> <span class="sqlScriptsKeyword">WHERE</span> <span class="sqlScriptsNormal">SensorId</span> <span class="sqlScriptsOperator">=</span> <span class="sqlScriptsNormal">@SensorId</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsKeyword">END</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsKeyword">ELSE</span> <span class="sqlScriptsKeyword">IF</span> <span class="sqlScriptsOperator">EXISTS</span> <span class="sqlScriptsOperator">(</span><span class="sqlScriptsKeyword">SELECT</span> <span class="sqlScriptsNormal">1</span> <span class="sqlScriptsKeyword">FROM</span> <span class="sqlScriptsNormal">core.Location</span> <span class="sqlScriptsKeyword">AS</span> <span class="sqlScriptsNormal">L</span> <span class="sqlScriptsOperator">INNER</span> <span class="sqlScriptsOperator">JOIN</span> <span class="sqlScriptsNormal">core.Sensor</span> <span class="sqlScriptsKeyword">AS</span> <span class="sqlScriptsNormal">S</span> <span class="sqlScriptsKeyword">ON</span> <span class="sqlScriptsNormal">S.SensorId</span> <span class="sqlScriptsOperator">=</span> <span class="sqlScriptsNormal">@SensorId</span> <span class="sqlScriptsOperator">AND</span> <span class="sqlScriptsNormal">L.Id</span> <span class="sqlScriptsOperator">=</span> <span class="sqlScriptsNormal">S.DeviceId</span> <span class="sqlScriptsKeyword">WHERE</span> <span class="sqlScriptsNormal">L.AssetId</span> <span class="sqlScriptsOperator">=</span> <span class="sqlScriptsNormal">@LocationAssetId</span> <span class="sqlScriptsOperator">AND</span> <span class="sqlScriptsNormal">L.RackLocation</span> <span class="sqlScriptsOperator">=</span> <span class="sqlScriptsNormal">@RackLocation</span><span class="sqlScriptsOperator">)</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsKeyword">BEGIN</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsComment">--Sensor was just set to where its housing device is located so let housing device have it back so that the sensor will move with the device if the device is moved.</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsKeyword">SELECT</span> <span class="sqlScriptsNormal">@LocationAssetId</span> <span class="sqlScriptsOperator">=</span> <span class="sqlScriptsNormal">DeviceId</span><span class="sqlScriptsNormal">,</span> <span class="sqlScriptsNormal">@RackLocation</span> <span class="sqlScriptsOperator">=</span> <span class="sqlScriptsOperator">NULL</span> <span class="sqlScriptsKeyword">FROM</span> <span class="sqlScriptsNormal">[core]</span><span class="sqlScriptsNormal">.Sensor</span> <span class="sqlScriptsKeyword">WHERE</span> <span class="sqlScriptsNormal">SensorId</span> <span class="sqlScriptsOperator">=</span> <span class="sqlScriptsNormal">@SensorId</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsKeyword">END</span><br><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsKeyword">UPDATE</span> <span class="sqlScriptsNormal">[core]</span><span class="sqlScriptsOperator">.</span><span class="sqlScriptsNormal">[Sensor]</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsKeyword">SET</span> <br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsNormal">UserName</span> <span class="sqlScriptsOperator">=</span> <span class="sqlScriptsFunction">COALESCE</span><span class="sqlScriptsOperator">(</span><span class="sqlScriptsNormal">@UserName</span><span class="sqlScriptsNormal">,</span> <span class="sqlScriptsNormal">[UserName]</span><span class="sqlScriptsOperator">)</span> <br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsNormal">,</span><span class="sqlScriptsNormal">LocationAssetId</span> <span class="sqlScriptsOperator">=</span> <span class="sqlScriptsNormal">@LocationAssetId</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsNormal">,</span><span class="sqlScriptsNormal">RackLocation</span> <span class="sqlScriptsOperator">=</span> <span class="sqlScriptsNormal">@RackLocation</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsNormal">,</span><span class="sqlScriptsNormal">Position</span> <span class="sqlScriptsOperator">=</span> <span class="sqlScriptsNormal">@Position</span><br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsKeyword">WHERE</span> <br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sqlScriptsNormal">SensorId</span> <span class="sqlScriptsOperator">=</span> <span class="sqlScriptsNormal">@SensorId</span><br> &nbsp;&nbsp;&nbsp;<br> &nbsp;&nbsp;&nbsp;<span class="sqlScriptsKeyword">END</span><br><span class="sqlScriptsNormal">GO</span><br></div></div></div><div class="panel panel-default panel-collapsible"><div class="panel-heading"><div class="expandCollapse"><img src="../../../../../Images/collapsed.png" alt="collapsed" title="collapsed" class="collapsed" style="display:none;"><img src="../../../../../Images/expanded.png" alt="expanded" title="expanded" class="expanded" style=""></div><a name="uses">Uses</a></div><div class="panel-body"><ul class="DependencyList"><li><a href="../../../../../RaMP/User_databases/2.6.1/Tables/Location.html">[core].[Location]</a></li> <li><a href="../../../../../RaMP/User_databases/2.6.1/Tables/Sensor.html">[core].[Sensor]</a></li> <li>[core]</li> </ul></div></div></div></div><div id="footer"><div class="row"><div id="customtext" class="col-sm-4"><div id="projectauthor">Author: &nbsp;No Limits Software</div></div><div id="copyright" class="col-sm-4">Copyright 2014 - All Rights Reserved</div><div id="date" class="col-sm-4">Created: 07 February 2014</div></div></div></body></html>